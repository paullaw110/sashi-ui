# 2026-01-30

## sashi-ui Work

### Task Status Change Bug (bff8398)
**Problem:** When changing task status from "to do" → "done" in calendar view, saving would appear to work but the status would revert back to the original value.

**Root cause:** `handleSave` and `handleStatusChange` in `TasksView.tsx` were using raw `fetch()` calls + `router.refresh()` instead of React Query mutations. The React Query cache never got updated, so the UI showed stale cached data.

**Fix:** Changed both functions to use `updateTask.mutateAsync()` for proper optimistic updates.

### Duplicate Status Dot (0940420)
**Problem:** Two dots appeared before "Not Started" in the TaskDetailModal status selector.

**Fix:** Removed the redundant dot from `SelectTrigger` — let `SelectValue` handle the display.

### Minimal Week Calendar Task Cards (367d96c)
- Removed colored status badges (now plain muted text)
- Removed priority borders except for non-negotiable
- Only non-negotiable tasks get red left border highlight

### Inline Org/Project Editing (fcaaf8c)
- New `InlineOrgProjectCell` component with Notion-style UX
- Click cell → opens searchable dropdown
- Select existing → auto-saves
- Type new → "Create [name]" option, Enter to confirm
- Clear option to remove selection
- Project dropdown filtered by task's organization
- PRD: `/docs/PRD-inline-org-project.md`

### Inline Status/Priority Editing (d415a01)
- New `InlineSelectCell` component with grouped options
- Status: To-do group (In Progress, Not Started, Waiting) + Complete group (Done)
- Priority: Non-Negotiable → Low with colored badges
- Click badge → dropdown opens, select to auto-save
- Clear option for priority (status always required)

### Sashi Design System (a11b25d, a041283)
- GT Sectra Display font loaded from `/public/fonts/`
- Dark palette: #0A0A0A → #141414 → #1A1A1A
- Lime accent #EFFF83 for focus states
- All components use CSS variables
- PRD: `/docs/PRD-sashi-design-system.md`

### Remove Due Column from Today/Next (6c78645)
- Added `hideDueColumn` prop to TaskTable
- Today and Next sections hide Due column (date implicit in section title)
- Other uses of TaskTable can still show it

### Fix Organization Assignment Bug (d316cda)
**Problem:** Creating or selecting an organization in the task table inline editor wasn't saving to the task.

**Root cause:** The PATCH `/api/tasks/[id]` endpoint was handling `projectId` but was missing `organizationId` in the update logic. The field was silently ignored.

**Fix:** Added `if (body.organizationId !== undefined) updates.organizationId = body.organizationId;` to the PATCH handler. Also added `revalidatePath` to POST `/api/organizations` for immediate UI refresh.

### Instant Calendar Interactions (284e64a)
**Goal:** Make the week view calendar feel instant and snappy — Paul couldn't see where tasks would land during drag.

**Implementation:**
- **Ghost preview during drag** — Shows dashed blue outline at target position with time range
- **Time tooltip on drag overlay** — Cursor shows "→ 2:30 PM" as you drag
- **Drop zone highlighting** — Target day column and hour slot get blue tint
- **Day header highlighting** — Target day header lights up during drag
- **Live resize preview** — Shows duration + end time as you drag the resize handle
- **Improved resize handle** — 4px touch target with visible bar indicator on hover
- **Task hidden during drag** — Original task fades out so only ghost shows position
- **15-minute snapping** — Times snap to 15-min increments for clean positioning

**Technical:**
- Added `DragMoveEvent` handler to track precise cursor position
- Ghost preview positioned using `pixelToTime()` conversion with snapping
- Duration field added to Task type in React Query hooks
- All mutations use optimistic updates via React Query `onMutate`

**Files changed:**
- `TimeWeekCalendar.tsx` — Ghost preview, time tooltip, resize improvements
- `Dashboard.tsx` — Added `handleTaskResize` with optimistic mutation
- `use-tasks.ts` — Added `duration` to Task type

### Task Modal Header Layout Fix (5ae16e5)
**Problems reported by Paul:**
1. Three-dot menu button was auto-focused when modal opened
2. Title should be bigger
3. More button (⋯) should be next to close button (X)
4. Both buttons should be same size and bigger
5. Delete dropdown had transparent background

**Fixes:**
- Disabled built-in DialogContent close button (`showCloseButton={false}`)
- Added custom header with both buttons in top-right corner
- Both buttons: `h-9 w-9` with 18px icons (was h-8 w-8 with 16px)
- More button has `tabIndex={-1}` to prevent auto-focus
- Title input has `autoFocus` so it gets focus instead
- Title size increased to `text-4xl` (was text-3xl)
- Dropdown menu gets solid background: `bg-[#1a1a1a] border-[var(--border-strong)]`

### Mac App PRD Queued
- Added "Mac App (Tauri)" to sashi-ui queue (queued status)
- Paul asked about codebase: **Same codebase** — Tauri wraps React app in native window
- Add `src-tauri/` folder with ~100 lines Rust config
- `npm run dev` → web, `npm run tauri dev` → native Mac app
- Changes in one reflect in both

## Key Learnings
- When React Query manages state, don't use raw `fetch()` + `router.refresh()` — use mutation hooks
- Always update sashi-ui status/queue when working (Paul sees it in the UI)
- Status is required (no clear option), Priority can be cleared
- Check API endpoints handle ALL fields a component might update — easy to miss new fields
- For instant drag feedback: track `DragMoveEvent` not just `DragEndEvent`, use ghost preview at target location
- Use `tabIndex={-1}` on buttons to prevent unwanted auto-focus in modals
- Dialog's built-in close can be hidden with `showCloseButton={false}` for custom layouts
